<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Profit Card — Nova (FINAL)</title>
  <meta name="robots" content="noindex">
  <style>
    /* ---------- CORE THEME ---------- */
    :root{
      --bg:#f3f6fb;
      --card-bg:#ffffff;
      --muted:#6b7280;
      --accent-start:#0ea5e9;
      --accent-end:#7c3aed;
      --success:#10b981;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.78);
      --radius:18px;
      --shadow: 0 12px 45px rgba(2,6,23,0.10);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    html,body{height:100%;margin:0}
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* ---------- WRAPPER & CARD ---------- */
    .wrap{perspective:1200px;display:flex;flex-direction:column;align-items:center;gap:14px}
    .card{
      width:480px;
      border-radius:var(--radius);
      background:var(--card-bg);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
      border:1px solid rgba(15,23,42,0.05);
      transform-style:preserve-3d;
      transition:transform .28s ease, box-shadow .28s ease;
    }
    .card.tilted{box-shadow:0 26px 80px rgba(2,6,23,0.18)}

    /* ---------- BANNER ---------- */
    .card__banner{
      height:150px;
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      display:flex;
      align-items:flex-end;
      padding:18px;
      gap:14px;
      position:relative;
    }
    .banner-halo{
      position:absolute; right:14px; bottom:-8px;
      width:120px;height:120px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), rgba(255,255,255,0) 40%);
      filter: blur(18px);
      transform: translateZ(40px);
      pointer-events:none;
    }

    .avatar{
      width:72px;height:72px;border-radius:14px;overflow:hidden;flex-shrink:0;
      transform: translateZ(60px);
      display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#6d28d9,#0891b2);
      box-shadow: 0 10px 30px rgba(99,102,241,0.12);
    }
    .avatar img{width:100%;height:100%;object-fit:contain;padding:10px;display:block;border-radius:12px;background:transparent}

    .title{color:white;font-size:18px;font-weight:800;text-shadow:0 6px 18px rgba(0,0,0,0.16)}
    .subtitle{color:rgba(255,255,255,0.92);font-size:12px}

    /* ---------- CONTENT ---------- */
    .card__content{padding:18px;transform:translateZ(30px)}
    .row{display:flex;align-items:center;justify-content:space-between}
    .col{display:flex;flex-direction:column}
    .label{font-size:12px;color:var(--muted)}
    .value-accent{font-size:20px;font-weight:900;background:linear-gradient(90deg,#7c3aed,#06b6d4);-webkit-background-clip:text;color:transparent}
    .pnl{font-weight:800}
    .pnl.positive{color:var(--success)}
    .pnl.negative{color:var(--danger)}
    .small-muted{font-size:12px;color:var(--muted)}

    /* ---------- TOKEN SELECT ---------- */
    .token-select{
      display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid rgba(15,23,42,0.06);font-weight:800;
    }
    .token-select select{background:transparent;border:0;outline:none;font-weight:800;appearance:none;padding-right:6px}

    /* ---------- 3D CHART ---------- */
    .chart-3d-wrap{width:100%;height:160px;display:flex;align-items:flex-end;justify-content:center;margin-top:12px;transform-style:preserve-3d}
    .chart-3d{width:94%;height:130px;transform:rotateX(16deg) skewX(-5deg) translateZ(20px);transform-origin:center bottom;border-radius:10px;overflow:visible}
    svg.area{width:100%;height:100%;display:block}
    .chart-grid line{stroke:rgba(15,23,42,0.04);stroke-width:1}
    .chart-grid .hline{stroke-dasharray:3 4}
    .layer{opacity:0.96;transition:all .7s cubic-bezier(.2,.9,.2,1)}
    .depth-1{transform:translateY(6px) scale(.995);opacity:.6}
    .depth-2{transform:translateY(12px) scale(.99);opacity:.36}

    /* ---------- INFO / DETAILS ---------- */
    .info-row{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .info-pill{background:linear-gradient(180deg,#ffffff,#fbfdff);padding:8px 12px;border-radius:10px;font-size:12px;color:#111827;font-weight:700;box-shadow:0 8px 24px rgba(15,23,42,0.04)}
    .details{margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .detail-card{background:linear-gradient(180deg,#ffffff,#fbfdff);padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.03);box-shadow:0 6px 18px rgba(12,18,35,0.03)}
    .detail-card .k{font-size:12px;color:var(--muted)} .detail-card .v{font-weight:800;margin-top:6px;font-size:14px;background:linear-gradient(90deg,#06b6d4,#7c3aed);-webkit-background-clip:text;color:transparent}

    .foot{display:flex;align-items:center;justify-content:space-between;margin-top:14px}
    .btn{border-radius:10px;padding:8px 12px;border:0;font-weight:800;cursor:pointer}
    .btn--ghost{background:transparent;color:var(--muted);border:1px solid rgba(15,23,42,0.06)}
    .btn--primary{background:linear-gradient(90deg,#0f172a,#0ea5e9);color:white;box-shadow:0 10px 30px rgba(2,6,23,0.12)}

    .hint{text-align:center;font-size:12px;color:var(--muted);margin-top:8px}

    /* responsive */
    @media (max-width:540px){ .card{width:100%} .chart-3d{transform:rotateX(14deg) skewX(-4deg) translateZ(10px)} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card" role="region" aria-label="Profit card">
      <div class="card__banner">
        <div class="banner-halo" aria-hidden></div>
        <div class="avatar"><img id="avatar-img" src="nova-icon.jpg" alt="Nova icon"></div>
        <div style="flex:1">
          <div class="title" id="card-title">Nova Portfolio</div>
          
        </div>
        <div style="transform:translateZ(60px)">
          <div style="background:rgba(255,255,255,0.12);padding:8px 12px;border-radius:999px;color:white;font-weight:800">
            <strong id="roi-text">+0%</strong> ROI
          </div>
        </div>
      </div>

      <div class="card__content">
        <div class="row">
          <div class="col">
            <div class="label">Invested</div>
            <div class="value-accent" id="invested">$0.00</div>
          </div>

          <div class="col" style="text-align:right">
            <div class="label">PNL</div>
            <div class="pnl positive" id="pnl">+$0.00</div>
            <div class="small-muted" id="pnl-percent">+0.00%</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;align-items:center;justify-content:space-between;gap:10px">
          <div>
            <div class="label">Position</div>
            <div class="value-accent" id="positionDisplay">$0.00</div>
            <div class="small-muted" id="avg-price">Avg Price: $0.00</div>
          </div>

          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
            <div class="token-select" title="Select token for amount display">
              <select id="tokenSelect" aria-label="Choose token">
                <option value="SOL">SOL</option>
                <option value="BNB">BNB</option>
                <option value="USD">USD</option>
              </select>
              <span style="font-size:12px;color:var(--muted);font-weight:800">Token</span>
            </div>
          </div>
        </div>

        <div class="chart-3d-wrap" aria-hidden>
          <div class="chart-3d">
            <svg class="area" viewBox="0 0 1000 260" preserveAspectRatio="none" id="svgChart">
              <defs>
                <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0%" stop-color="#10b981" stop-opacity="0.95"/>
                  <stop offset="100%" stop-color="#10b981" stop-opacity="0.06"/>
                </linearGradient>
                <linearGradient id="g2" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0%" stop-color="#06b6d4" stop-opacity="0.9"/>
                  <stop offset="100%" stop-color="#06b6d4" stop-opacity="0.04"/>
                </linearGradient>
                <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                  <feDropShadow dx="0" dy="12" stdDeviation="18" flood-color="#0b1220" flood-opacity="0.12"/>
                </filter>
              </defs>

              <g class="chart-grid">
                <line x1="0" y1="40" x2="1000" y2="40" class="hline"></line>
                <line x1="0" y1="100" x2="1000" y2="100" class="hline"></line>
                <line x1="0" y1="160" x2="1000" y2="160" class="hline"></line>
                <line x1="0" y1="220" x2="1000" y2="220" class="hline"></line>
              </g>

              <g id="layer-2" class="layer depth-2"></g>
              <g id="layer-1" class="layer depth-1"></g>
              <g id="layer-0" class="layer"></g>
              <g id="fg-glow"></g>
            </svg>
          </div>
        </div>

        <div class="info-row">
          <div class="info-pill">24h <strong id="change24-val">+0%</strong></div>
          <div class="info-pill">Last trade <span id="last-trade-val">just now</span></div>
          <div class="info-pill">Risk <strong id="risk-val">Medium</strong></div>
        </div>

        <div class="details">
          <div class="detail-card"><div class="k">Strategy</div><div class="v" id="strategy">—</div></div>
          <div class="detail-card"><div class="k">Win rate</div><div class="v" id="winrate">—</div></div>
          <div class="detail-card"><div class="k">Sharpe (est.)</div><div class="v" id="sharpe">—</div></div>
          <div class="detail-card"><div class="k">Liquidity</div><div class="v" id="liquidity">High</div></div>
        </div>

        <div class="foot">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="font-size:12px;color:var(--muted)">Real-time snapshot<br><span id="ny-time">Loading NY time...</span></div>
          </div>
          <div><button id="btn-details" class="btn btn--ghost">Details</button></div>
        </div>
      </div>
    </div>

    <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
      <button id="btn-refresh" class="btn btn--primary">Refresh</button>
      <button id="btn-export" class="btn btn--ghost">Export</button>
    </div>

    <div class="hint">Move mouse to tilt — choose token to view amounts. If CSS doesn't update, hard refresh (Ctrl/Cmd+Shift+R).</div>
  </div>

  <script>
  /* ---------- Utilities & NY time ---------- */
  const $nyTime = document.getElementById('ny-time');
  (function updNY(){ const now=new Date(); const f=new Intl.DateTimeFormat('en-US',{timeZone:'America/New_York',year:'numeric',month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true,timeZoneName:'short'}); if($nyTime)$nyTime.textContent=f.format(now); setTimeout(updNY,1000); })();

  // DOM refs
  const $card = document.getElementById('card');
  const $invested = document.getElementById('invested');
  const $pnl = document.getElementById('pnl');
  const $pnlPercent = document.getElementById('pnl-percent');
  const $positionDisplay = document.getElementById('positionDisplay');
  const $avgPrice = document.getElementById('avg-price');
  const $roiText = document.getElementById('roi-text');
  const $change24 = document.getElementById('change24-val');
  const $lastTrade = document.getElementById('last-trade-val');
  const $risk = document.getElementById('risk-val');
  const $strategy = document.getElementById('strategy');
  const $winrate = document.getElementById('winrate');
  const tokenSelect = document.getElementById('tokenSelect');
  const layer0 = document.getElementById('layer-0'), layer1 = document.getElementById('layer-1'), layer2 = document.getElementById('layer-2'), fgGlow = document.getElementById('fg-glow');

  const rand = (a,b)=> Math.random()*(b-a)+a;
  const randInt = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
  const clamp = (v,a,b)=> Math.max(a,Math.min(b,v));
  const fmt = n => new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2}).format(n);

  // CoinGecko fetch (public demo); fallback if fails
  let tokenPrices = { SOL: 100, BNB: 320, USD: 1 };
  async function fetchPrices(){
    try{
      const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana,binancecoin&vs_currencies=usd');
      if(!res.ok) throw new Error('fetch failed');
      const data = await res.json();
      if(data.solana?.usd) tokenPrices.SOL = data.solana.usd;
      if(data.binancecoin?.usd) tokenPrices.BNB = data.binancecoin.usd;
    }catch(err){
      console.warn('CoinGecko fetch failed — using fallback prices', err);
    }
  }

  // Chart generation helpers
  function makePointsFromPrices(startPrice, endPrice, points=22){
    const arr=[];
    for(let i=0;i<points;i++){
      const t=i/(points-1);
      const ease=Math.pow(t, 0.9 + Math.random()*0.4);
      const jitter=(endPrice-startPrice)*0.02*(Math.random()-0.5);
      const v = startPrice + (endPrice - startPrice)*ease + jitter;
      arr.push(Math.max(0.0001, Math.round(v*100)/100));
    }
    return arr;
  }
  function pointsToArea(points){
    const w=1000,h=220,pad=40,len=points.length,min=Math.min(...points),max=Math.max(...points),range=Math.max(1e-6,max-min);
    let path='';
    points.forEach((p,i)=>{ const x=pad+(i/(len-1))*(w-pad*2); const y=pad+(1-(p-min)/range)*(h-pad*2); path += (i===0?'M ':' L ') + x.toFixed(2) + ' ' + y.toFixed(2); });
    const coords = path.replace(/^M /,'').split(' L ').map(s=>s.split(' ').map(Number));
    const last = coords[coords.length-1], first = coords[0], bottom = 220 - 18;
    return { area: `${path} L ${last[0]} ${bottom} L ${first[0]} ${bottom} Z`, lastCoord: last };
  }
  function draw3D(points){
    const {area:a0} = pointsToArea(points);
    const offset1 = points.map(p => p - (Math.abs(p)*0.02 + 2));
    const offset2 = points.map(p => p - (Math.abs(p)*0.04 + 6));
    const a1 = pointsToArea(offset1).area;
    const a2 = pointsToArea(offset2).area;
    const l0 = document.createElementNS('http://www.w3.org/2000/svg','path');
    const l1 = document.createElementNS('http://www.w3.org/2000/svg','path');
    const l2 = document.createElementNS('http://www.w3.org/2000/svg','path');
    layer0.innerHTML=''; layer1.innerHTML=''; layer2.innerHTML=''; fgGlow.innerHTML='';
    l2.setAttribute('d', a2); l2.setAttribute('fill','url(#g2)'); l2.style.opacity='0.34'; l2.setAttribute('filter','url(#shadow)'); layer2.appendChild(l2);
    l1.setAttribute('d', a1); l1.setAttribute('fill','url(#g2)'); l1.style.opacity='0.58'; l1.setAttribute('filter','url(#shadow)'); layer1.appendChild(l1);
    l0.setAttribute('d', a0); l0.setAttribute('fill','url(#g1)'); l0.setAttribute('stroke','#065f52'); l0.setAttribute('stroke-width','2'); layer0.appendChild(l0);
    // glow at end
    const lastCoord = pointsToArea(points).lastCoord;
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx', lastCoord[0]); c.setAttribute('cy', lastCoord[1]); c.setAttribute('r', 8); c.setAttribute('fill', '#10b981'); c.setAttribute('fill-opacity','0.92'); fgGlow.appendChild(c);
    // animate stroke
    try {
      const L = l0.getTotalLength();
      l0.style.strokeDasharray = L; l0.style.strokeDashoffset = L; l0.getBoundingClientRect();
      l0.style.transition = 'stroke-dashoffset 900ms cubic-bezier(.2,.9,.2,1)';
      l0.style.strokeDashoffset = '0';
      setTimeout(()=>{ l0.style.transition=''; l0.style.strokeDasharray=''; l0.style.strokeDashoffset=''; }, 1100);
    } catch(e){}
  }

  // core calculations from priceNow & avgPrice
  function computeFromPrices(priceNow, avgPrice, invested){
    const position = invested / avgPrice;
    const currentValue = position * priceNow;
    const pnl = +(currentValue - invested);
    const pnlPercent = invested ? (pnl / invested) : 0;
    return { position, currentValue, pnl, pnlPercent };
  }

  // deterministic helpers
  function winrateFromPnl(pct){
    const minP=0.35, maxP=0.75; const t = clamp((pct - minP)/(maxP - minP), 0, 1);
    return `${Math.round(70 + t*(96-70))}%`;
  }
  function strategyFromPnl(pct){
    if(pct > 0.62) return 'Aggressive Growth';
    if(pct > 0.45) return 'Growth';
    return 'Conservative';
  }

  // animate value helper
  function animateValue(el, start, end, dur=700, format=(v)=>v){
    const s = performance.now();
    (function frame(now){
      const p = Math.min(1,(now - s)/dur);
      const eased = p < 0.5 ? 2*p*p : (-1 + (4 - 2*p)*p);
      const val = start + (end - start) * eased;
      el.textContent = format(val);
      if(p < 1) requestAnimationFrame(frame);
    })(performance.now());
  }

  // recalc view & update UI based on token and computed data
  function recalcAndRender(state){
    const token = tokenSelect.value;
    if(token === 'USD'){
      animateValue($positionDisplay, parseFloat($positionDisplay.textContent.replace(/[^0-9.-]+/g,''))||0, state.invested, 700, v=>fmt(v));
      $avgPrice.textContent = '1 USD';
      // keep PNL etc computed in USD (position is dollars)
      animateValue($invested, parseFloat($invested.textContent.replace(/[^0-9.-]+/g,''))||0, state.invested, 700, v=>fmt(v));
      animateValue($pnl, parseFloat($pnl.textContent.replace(/[^0-9.-]+/g,''))||0, state.pnl, 700, v=> (state.pnl>=0?'+':'-') + fmt(Math.abs(Math.round(v*100)/100)));
      $pnlPercent.textContent = (state.pnlPercent>=0?'+':'') + (state.pnlPercent*100).toFixed(2) + '%';
    } else {
      const priceNow = tokenPrices[token] || 1;
      const avgPrice = +(priceNow * (rand(0.55, 0.95))).toFixed(2);
      const { position, currentValue, pnl, pnlPercent } = computeFromPrices(priceNow, avgPrice, state.invested);
      animateValue($positionDisplay, parseFloat($positionDisplay.textContent.replace(/[^0-9.-]+/g,''))||0, position, 700, v=> `${Number(v).toFixed(4)} ${token} ≈ ${fmt(v*priceNow)}`);
      $avgPrice.textContent = `Avg Price: ${fmt(avgPrice)} / ${token}`;
      animateValue($invested, parseFloat($invested.textContent.replace(/[^0-9.-]+/g,''))||0, state.invested, 700, v=>fmt(v));
      animateValue($pnl, parseFloat($pnl.textContent.replace(/[^0-9.-]+/g,''))||0, pnl, 700, v=> (pnl>=0?'+':'-') + fmt(Math.abs(Math.round(v*100)/100)));
      $pnlPercent.textContent = (pnlPercent>=0?'+':'') + (pnlPercent*100).toFixed(2) + '%';
      $roiText.textContent = (pnlPercent>=0?'+':'') + Math.round(pnlPercent*100) + '%';
      $winrate.textContent = winrateFromPnl(pnlPercent);
      $strategy.textContent = strategyFromPnl(pnlPercent);
      $change24.textContent = '+' + (rand(0.5,6.5)).toFixed(2) + '%';
      $risk.textContent = pnlPercent > 0.62 ? 'High' : (pnlPercent < 0.45 ? 'Low' : 'Medium');
      const pts = makePointsFromPrices(avgPrice, priceNow, 22);
      draw3D(pts);
    }
  }

  // main generator: fetch prices, create state, render
  async function generateAndRender(){
    await fetchPrices();
    const invested = +( (Math.random() * (50000 - 2000) + 2000).toFixed(2) );
    const tok = tokenSelect.value;
    const priceNow = tokenPrices[tok] || 1;
    // ensure avgPrice <= priceNow so PNL positive
    const avgPrice = +(priceNow * (rand(0.55, 0.95))).toFixed(2);
    const { position, currentValue, pnl, pnlPercent } = computeFromPrices(priceNow, avgPrice, invested);
    const state = { invested, avgPrice, priceNow, position, currentValue, pnl, pnlPercent };
    recalcAndRender(state);
  }

  // initial run
  (async function init(){
    await fetchPrices();
    generateAndRender();
  })();

  // events
  document.getElementById('btn-refresh').addEventListener('click', ()=> {
    generateAndRender();
    $card.classList.add('tilted');
    $card.animate([{transform:'scale(1)'},{transform:'scale(.996)'},{transform:'scale(1)'}],{duration:320}).onfinish = ()=> $card.classList.remove('tilted');
  });
  tokenSelect.addEventListener('change', ()=> generateAndRender());
  document.getElementById('btn-details').addEventListener('click', ()=> alert('Details placeholder'));
  document.getElementById('btn-export').addEventListener('click', ()=> alert('Export placeholder — use server renderer for production'));

  // tilt interaction
  (function enableTilt(){
    const rect = () => $card.getBoundingClientRect();
    let bounds = rect();
    window.addEventListener('resize', ()=> bounds = rect());
    $card.addEventListener('mousemove', e => {
      const x = e.clientX - bounds.left, y = e.clientY - bounds.top;
      const px = (x / bounds.width) - 0.5, py = (y / bounds.height) - 0.5;
      const rx = clamp(-py * 9, -12, 12), ry = clamp(px * 12, -16, 16);
      $card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    });
    $card.addEventListener('mouseleave', ()=> $card.style.transform = '');
  })();
  </script>
</body>
</html>
