<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Profit Card â€” Nova (debugged)</title>
  <style>
    :root{
      --bg:#f7f9fb;
      --card-bg: #ffffff;
      --muted:#6b7280;
      --accent-1: linear-gradient(135deg,#5616af 0%,#4706d4 100%);
      --accent-2: linear-gradient(135deg,#7221d5 0%,#8f3bf6 100%);
      --success:#10b981;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.7);
      --radius:16px;
      --shadow: 0 6px 30px rgba(16,24,40,0.08);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{display:flex;flex-direction:column;align-items:center;gap:14px}

    /* Card layout */
    .card{
      width:420px;
      border-radius:var(--radius);
      background:var(--card-bg);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
      border:1px solid rgba(15,23,42,0.05);
    }

    .card__banner{
      height:130px;
      background:var(--accent-2);
      background-size:cover;
      display:flex;
      align-items:flex-end;
      padding:16px 18px;
      gap:12px;
    }

    .avatar{
      width:62px;height:62px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;
      background:var(--accent-1);
      box-shadow: 0 8px 22px rgba(99,102,241,0.14);
      flex-shrink:0; overflow:hidden;
    }
    .avatar img {
  width: 100%;
  height: 100%;
  object-fit: contain;   /* ðŸ‘ˆ THIS is the key */
  padding: 6px;          /* optional: breathing space */
  display: block;
  border-radius: 12px;
  background: transparent;
}


    .title{color:white;font-size:16px;font-weight:700;}
    .subtitle{color:rgba(255,255,255,0.94);font-size:12px;opacity:0.95}

    .card__content{padding:18px}

    .row{display:flex;align-items:center;justify-content:space-between}
    .col{display:flex;flex-direction:column}

    .label{font-size:12px;color:var(--muted)}
    .value{font-size:20px;font-weight:800}

    .pnl{font-weight:800}
    .pnl.positive{color:var(--success)}
    .pnl.negative{color:var(--danger)}

    .badge{
      display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;font-size:12px;font-weight:700;background:rgba(255,255,255,0.18);backdrop-filter:blur(6px);color:white
    }

    .info-row{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
    .info-pill{background:#f3f4f6;padding:8px 10px;border-radius:10px;font-size:12px;color:#111827;font-weight:600;box-shadow:0 4px 14px rgba(17,24,39,0.03)}

    .small-muted{font-size:12px;color:var(--muted)}

    /* Sparkline container */
    .sparkline-wrap{width:180px;height:48px;display:flex;align-items:center;justify-content:center}

    /* footer */
    .foot{display:flex;align-items:center;justify-content:space-between;margin-top:16px}
    .btn{border-radius:10px;padding:8px 12px;border:0;font-weight:700;cursor:pointer}
    .btn--ghost{background:transparent;color:var(--muted);border:1px solid rgba(15,23,42,0.04)}
    .btn--primary{background:#0f172a;color:white;box-shadow:0 10px 30px rgba(15,23,42,0.12)}

    /* more details area inside card */
    .details{margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .detail-card{background:linear-gradient(180deg,#ffffff,#fbfdff);padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.03);box-shadow:0 6px 18px rgba(12,18,35,0.03)}
    .detail-card .k{font-size:12px;color:var(--muted)} .detail-card .v{font-weight:700;margin-top:6px;font-size:14px}

    /* utilities */
    .muted{color:var(--muted)}
    .pos{color:var(--success)}
    .neg{color:var(--danger)}

    /* animations */
    .fade-in{animation:fadeIn 420ms ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

    @media (max-width:460px){
      .card{width:100%}
      .wrap{padding:12px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card fade-in" role="region" aria-label="Profit card">
      <div class="card__banner">
        <div class="avatar" id="avatar">
          <!-- Put your image path relative to this HTML file here -->
          <img src="nova-icon.jpg" style="width:62px;height:62px;object-fit:contain;padding:8px;">

        </div>

        <div style="flex:1">
          <div class="title" id="card-title">Nova Portfolio</div>
        </div>

        <div>
          <div class="badge" id="roi-badge" title="Approx return">
            <strong id="roi-text">+50%</strong>
            <span class="small-muted" style="font-weight:600">ROI</span>
          </div>
        </div>
      </div>

      <div class="card__content">
        <div class="row">
          <div class="col">
            <div class="label">Invested</div>
            <div class="value" id="invested">$0.00</div>

          </div>

          <div class="col" style="text-align:right">
            <div class="label">PNL</div>
            <div class="pnl positive" id="pnl">+$0.00</div>
            <div class="small-muted" id="pnl-percent">+0.00%</div>
          </div>
        </div>

        <div class="row" style="margin-top:12px;align-items:center">
          <div style="flex:1">
            <div class="label">Position (units)</div>
            <div class="value" id="position">0</div>
            <div class="small-muted" id="avg-price">Avg Price: $0.00</div>
          </div>

          <div class="sparkline-wrap" aria-hidden>
            <svg id="sparkline" width="180" height="48" viewBox="0 0 180 48"></svg>
          </div>
        </div>

        <div class="info-row" aria-hidden>
          <div class="info-pill" id="change24">24h +<span id="change24-val">3.2%</span></div>
          <div class="info-pill" id="ath">All-time PNL <strong id="ath-val">$0</strong></div>
          <div class="info-pill" id="last-trade">Last trade <span id="last-trade-val">just now</span></div>
          <div class="info-pill" id="risk">Risk <strong id="risk-val">Medium</strong></div>
        </div>

        <div class="details" id="details">
          <div class="detail-card">
            <div class="k">Strategy</div>
            <div class="v" id="strategy">Growth</div>
          </div>

          <div class="detail-card">
            <div class="k">Win rate</div>
            <div class="v" id="winrate">87%</div>
          </div>

          <div class="detail-card">
            <div class="k">Trades (30d)</div>
            <div class="v" id="trades">124</div>
          </div>

          <div class="detail-card">
            <div class="k">Sharpe (est.)</div>
            <div class="v" id="sharpe">1.54</div>
          </div>
        </div>

        <div class="foot" style="margin-top:14px">
          <div style="display:flex;align-items:center;gap:8px">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 17l6-6 4 4 8-8" stroke="#374151" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div class="small-muted">
  Real-time snapshot<br>
  <span id="ny-time">Loading NY time...</span>
</div>

          </div>

          <div style="display:flex;gap:8px">
            <button class="btn btn--ghost" id="btn-details">Details</button>
          </div>
        </div>
      </div>
    </div>

    <!-- REFRESH BUTTON placed below the card (outside) -->
    <div style="display:flex;gap:10px;align-items:center">
      <button id="btn-refresh" class="btn btn--primary" title="Generate new random portfolio">Refresh (randomize)</button>
      <button id="btn-export" class="btn btn--ghost" title="Export screenshot (not implemented here)">Export</button>
    </div>
  </div>

  <script>


const $nyTime = document.getElementById('ny-time');

  function updateNYTime() {
    const now = new Date();

    const formatter = new Intl.DateTimeFormat('en-US', {
      timeZone: 'America/New_York',
      year: 'numeric',
      month: 'short',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true,
      timeZoneName: 'short'
    });

    if ($nyTime) {
      $nyTime.textContent = formatter.format(now);
    }
  }

  // Initial call
  updateNYTime();

  // Update every second
  setInterval(updateNYTime, 1000);
    /* Debugged logic and safe DOM updates */

    // Determine avatar src from the HTML element (do not override unless you want to)
    const $avatarImg = document.getElementById('avatar-img');
    // If you want to force a different image, set novaIcon below to a URL and it will override:
    // const novaIcon = 'https://example.com/your-nova.png';
    // Otherwise keep undefined to use the HTML src attribute.
    let novaIcon; // leave undefined to keep <img src="..."> as-is

    if ($avatarImg && typeof novaIcon === 'string' && novaIcon.length) {
      $avatarImg.src = novaIcon;
    }
    // DOM refs (some elements may not exist in other edits â€” guard by checking)
    const $invested = document.getElementById('invested');
    const $pnl = document.getElementById('pnl');
    const $pnlPercent = document.getElementById('pnl-percent');
    const $position = document.getElementById('position');
    const $avgPrice = document.getElementById('avg-price');
    const $roiText = document.getElementById('roi-text');
    const $pctBadge = document.getElementById('roi-badge');
    const $spark = document.getElementById('sparkline');
    const $change24 = document.getElementById('change24-val');
    const $ath = document.getElementById('ath-val');
    const $lastTrade = document.getElementById('last-trade-val');
    const $risk = document.getElementById('risk-val');
    const $strategy = document.getElementById('strategy');
    const $winrate = document.getElementById('winrate');
    const $trades = document.getElementById('trades');
    const $sharpe = document.getElementById('sharpe');

    // Helpers
    function rand(min, max){
      return Math.random() * (max - min) + min;
    }
    function randInt(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function fmt(n){
      return new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2}).format(n);
    }
    function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

    // Upward-only-ish sparkline generator
    function makeSparkline(base, pnl, points=10){
      const start = Math.max(10, base - pnl * rand(0.3, 0.6));
      const end = base + pnl * rand(0.8, 1.2);
      const arr = [];
      for(let i=0;i<points;i++){
        const t = i/(points-1);
        const val = start + (end - start) * (t**(0.9 + rand(0,0.6))) + rand(-base*0.02, base*0.02);
        arr.push(Math.max(1, Math.round(val*100)/100));
      }
      return arr;
    }

    // Render sparkline SVG
    function renderSparkline(points){
      if (!$spark) return;
      const w = 180, h = 48, pad = 6;
      const min = Math.min(...points), max = Math.max(...points);
      const range = Math.max(1e-6, max - min);
      const coords = points.map((p,i)=>{
        const x = pad + (i/(points.length-1)) * (w - pad*2);
        const y = h - pad - ((p-min)/range) * (h - pad*2);
        return [x,y];
      });
      const path = coords.map((c,i)=> (i===0? 'M ':'L ') + c[0].toFixed(2) + ' ' + c[1].toFixed(2)).join(' ');
      const color = points[points.length-1] >= points[0] ? '#10b981' : '#ef4444';
      const areaPath = coords.map((c,i)=> (i===0? 'M ':'L ') + c[0].toFixed(2) + ' ' + c[1].toFixed(2)).join(' ') + ' L ' + (w-pad) + ' ' + (h-pad) + ' L ' + pad + ' ' + (h-pad) + ' Z';
      $spark.innerHTML = '';
      const ns = 'http://www.w3.org/2000/svg';
      const area = document.createElementNS(ns, 'path');
      area.setAttribute('d', areaPath);
      area.setAttribute('fill', color);
      area.setAttribute('fill-opacity', '0.06');
      const pathEl = document.createElementNS(ns, 'path');
      pathEl.setAttribute('d', path.replace(/^L /,'').replace(/ M /,'M'));
      pathEl.setAttribute('fill', 'none');
      pathEl.setAttribute('stroke', color);
      pathEl.setAttribute('stroke-width', '2');
      pathEl.setAttribute('stroke-linecap','round');
      pathEl.setAttribute('stroke-linejoin','round');
      $spark.appendChild(area);
      $spark.appendChild(pathEl);
    }

    // Generate randomized but always-positive portfolio data
    function generateData(){
      const invested = Math.round(rand(2000, 50000) * 100) / 100;
      const pnlPercent = clamp(rand(0.35, 0.7), 0.35, 0.75);
      const pnl = Math.round(invested * pnlPercent * 100) / 100;
      const avgPrice = Math.round(rand(Math.max(0.5, invested/2000), Math.max(1, invested/20)) * 100) / 100;
      const position = Math.round((invested / avgPrice) * (1 + rand(-0.08,0.08)) * 10000) / 10000;
      const change24 = (rand(1, 8)).toFixed(2);
      const ath = Math.round((pnl + invested * rand(0.2, 1.5)) * 100) / 100;
      const minutesAgo = randInt(0, 180);
      const lastTrade = minutesAgo === 0 ? 'just now' : minutesAgo < 60 ? `${minutesAgo}m ago` : `${Math.floor(minutesAgo/60)}h ago`;
      let risk = 'Medium';
      if (pnlPercent > 0.62) risk = 'High';
      else if (pnlPercent < 0.45) risk = 'Low';
      const tradeCount = randInt(40, 220);
      const winrate = randInt(70, 96) + '%';
      const sharpe = (rand(0.9, 1.9)).toFixed(2);
      const strategy = (pnlPercent > 0.55) ? 'Aggressive Growth' : 'Growth';
      const spark = makeSparkline(invested, pnl, 10);

      return { invested, pnl, pnlPercent, avgPrice, position, change24, ath, lastTrade, risk, tradeCount, winrate, sharpe, strategy, spark };
    }

    // Apply data to DOM with small transitions (guard missing nodes)
    function applyData(d){
      if ($invested) $invested.textContent = fmt(d.invested);
      if ($pnl) { $pnl.textContent = '+' + fmt(d.pnl); $pnl.classList.remove('negative'); $pnl.classList.add('positive'); }
      if ($pnlPercent) $pnlPercent.textContent = '+' + (d.pnlPercent*100).toFixed(2) + '%';
      if ($position) $position.textContent = d.position.toLocaleString();
      if ($avgPrice) $avgPrice.textContent = 'Avg Price: ' + fmt(d.avgPrice);
      if ($roiText) $roiText.textContent = '+' + Math.round(d.pnlPercent*100) + '%';
      if ($pctBadge) { $pctBadge.style.background = 'rgba(255,255,255,0.18)'; $pctBadge.style.color = '#10b981'; }
      if ($change24) $change24.textContent = d.change24 + '%';
      if ($ath) $ath.textContent = fmt(d.ath);
      if ($lastTrade) $lastTrade.textContent = d.lastTrade;
      if ($risk) $risk.textContent = d.risk;
      if ($strategy) $strategy.textContent = d.strategy;
      if ($winrate) $winrate.textContent = d.winrate;
      if ($trades) $trades.textContent = d.tradeCount;
      if ($sharpe) $sharpe.textContent = d.sharpe;

      renderSparkline(d.spark);
    }

    // Initial render
    let current = generateData();
    applyData(current);

    // Refresh button behavior
    const $btnRefresh = document.getElementById('btn-refresh');
    if ($btnRefresh) {
      $btnRefresh.addEventListener('click', ()=>{
        current = generateData();
        applyData(current);
        const card = document.querySelector('.card');
        if (card) card.animate([{ transform: 'scale(1)' }, { transform: 'scale(0.996)' }, { transform: 'scale(1)' }], { duration: 300 });
      });
    }

    // Details button placeholder (inside card)
    const $btnDetails = document.getElementById('btn-details');
    if ($btnDetails) {
      $btnDetails.addEventListener('click', ()=>{
        alert('Details modal: implement your transactions list, filters, and trade view here.');
      });
    }
  </script>
</body>
</html>

